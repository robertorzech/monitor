<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Affiliate Dashboard - Partnerize + Zeropark + Awin</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #0a0e1a;
  color: #e0e6ed;
  padding: 20px;
  line-height: 1.6;
}
.container { max-width: 1400px; margin: 0 auto; }
h1 { 
  color: #ffa726; 
  margin-bottom: 10px; 
  font-size: 28px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.subtitle {
  color: #8b95a5;
  font-size: 14px;
  margin-bottom: 30px;
}

/* Setup Form */
.setup-form {
  background: #151b2d;
  padding: 30px;
  border-radius: 12px;
  margin-bottom: 30px;
}
.form-section {
  margin-bottom: 30px;
  padding-bottom: 30px;
  border-bottom: 1px solid #2d3748;
}
.form-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}
.form-section h3 {
  color: #ffa726;
  font-size: 16px;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.form-group {
  margin-bottom: 15px;
}
label {
  display: block;
  margin-bottom: 6px;
  color: #8b95a5;
  font-size: 13px;
}
input {
  width: 100%;
  padding: 10px 12px;
  background: #1e2738;
  border: 1px solid #2d3748;
  border-radius: 6px;
  color: #e0e6ed;
  font-size: 14px;
}
input:focus {
  outline: none;
  border-color: #ffa726;
}
input::placeholder {
  color: #5a6070;
}
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}
.btn {
  padding: 12px 24px;
  background: #ffa726;
  color: #0a0e1a;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  width: 100%;
  transition: background 0.2s;
}
.btn:hover {
  background: #fb8c00;
}
.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.btn-secondary {
  background: #2d3748;
  color: #e0e6ed;
  margin-top: 10px;
}
.btn-secondary:hover {
  background: #3d4758;
}

/* Dashboard */
.dashboard {
  display: none;
}
.dashboard.active {
  display: block;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  border-bottom: 2px solid #2d3748;
}
.tab {
  padding: 12px 24px;
  background: transparent;
  color: #8b95a5;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  font-size: 15px;
  font-weight: 500;
  margin-bottom: -2px;
  transition: all 0.2s;
}
.tab:hover {
  color: #e0e6ed;
}
.tab.active {
  color: #ffa726;
  border-bottom-color: #ffa726;
}

/* Controls */
.controls {
  display: flex;
  gap: 15px;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.refresh-btn {
  background: #2d3748;
  color: #e0e6ed;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.refresh-btn:hover {
  background: #3d4758;
}
.auto-refresh {
  display: flex;
  align-items: center;
  gap: 10px;
}
.auto-refresh select {
  background: #1e2738;
  border: 1px solid #2d3748;
  border-radius: 6px;
  color: #e0e6ed;
  padding: 8px 12px;
  font-size: 14px;
}
.last-update {
  color: #8b95a5;
  font-size: 13px;
  margin-left: auto;
}

/* Tab Content */
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

/* Status Grid */
.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.status-card {
  background: #151b2d;
  padding: 20px;
  border-radius: 10px;
  border-left: 4px solid;
  transition: transform 0.2s;
}
.status-card:hover {
  transform: translateY(-2px);
}
.status-card.pending { border-left-color: #f5a623; }
.status-card.approved { border-left-color: #00e676; }
.status-card.confirmed { border-left-color: #64b5f6; }
.status-card.available { border-left-color: #4caf50; }
.status-card.paid { border-left-color: #4fc3f7; }
.status-label {
  font-size: 13px;
  color: #8b95a5;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.status-value {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 4px;
}
.status-currency {
  font-size: 13px;
  color: #8b95a5;
}
.change-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  margin-top: 6px;
}
.change-badge.up {
  background: rgba(0, 230, 118, 0.2);
  color: #00e676;
}
.change-badge.down {
  background: rgba(255, 68, 68, 0.2);
  color: #ff4444;
}

/* Simple Table */
.simple-table {
  background: #151b2d;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 30px;
}
.simple-table h3 {
  color: #e0e6ed;
  font-size: 16px;
  margin-bottom: 15px;
}
.table-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  padding: 12px 0;
  border-bottom: 1px solid #2d3748;
  font-size: 14px;
}
.table-row:last-child {
  border-bottom: none;
}
.table-row:first-child {
  font-weight: 600;
  color: #8b95a5;
  font-size: 13px;
}

/* Notifications Log */
.notif-log {
  background: #151b2d;
  border-radius: 10px;
  padding: 20px;
  max-height: 300px;
  overflow-y: auto;
}
.notif-log h3 {
  color: #e0e6ed;
  font-size: 16px;
  margin-bottom: 15px;
}
.notif-entry {
  padding: 10px;
  border-left: 3px solid #ffa726;
  background: #1e2738;
  border-radius: 6px;
  margin-bottom: 10px;
  font-size: 13px;
}
.notif-time {
  color: #8b95a5;
  font-size: 12px;
  display: block;
  margin-bottom: 4px;
}
.notif-msg {
  color: #e0e6ed;
}
.notif-empty {
  text-align: center;
  padding: 30px;
  color: #5a6070;
}

/* Error/Success Messages */
.error, .success {
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 20px;
  display: none;
  font-size: 14px;
}
.error.active, .success.active {
  display: block;
}
.error {
  background: #2d1517;
  border: 1px solid #ff4444;
  color: #ff6b6b;
}
.success {
  background: #1a2d1a;
  border: 1px solid #00e676;
  color: #00ff88;
}

/* Loading */
.loading {
  text-align: center;
  padding: 40px;
  color: #8b95a5;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: #151b2d;
  border: 1px solid #ffa726;
  color: #e0e6ed;
  padding: 16px 24px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s;
  z-index: 1000;
}
.toast.show {
  opacity: 1;
  transform: translateY(0);
}

/* Connection Status */
.conn-status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
}
.conn-status.connected {
  background: rgba(0, 230, 118, 0.1);
  color: #00e676;
}
.conn-status.disconnected {
  background: rgba(255, 68, 68, 0.1);
  color: #ff4444;
}
.conn-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}
</style>
</head>
<body>
<div class="container">
  <h1>
    üí∞ Affiliate Dashboard
    <span class="conn-status disconnected" id="conn-status">
      <span class="conn-dot"></span>
      <span id="conn-text">Roz≈ÇƒÖczony</span>
    </span>
  </h1>
  <div class="subtitle">Partnerize ¬∑ Zeropark ¬∑ Awin</div>
  
  <!-- Setup Form -->
  <div class="setup-form" id="setup">
    <div class="error" id="setup-error"></div>
    
    <div class="form-section">
      <h3>üîµ Partnerize Payment Monitor</h3>
      <div class="form-group">
        <label>Application Key</label>
        <input type="text" id="pz-app-key" placeholder="Your Application Key">
      </div>
      <div class="form-group">
        <label>User API Key</label>
        <input type="password" id="pz-api-key" placeholder="Your User API Key">
      </div>
      <div class="form-group">
        <label>Publisher ID</label>
        <input type="text" id="pz-publisher-id" placeholder="10111308478">
      </div>
    </div>
    
    <div class="form-section">
      <h3>üü¢ Zeropark Stats</h3>
      <div class="form-group">
        <label>API Token</label>
        <input type="password" id="zp-token" placeholder="Your Zeropark API Token">
      </div>
    </div>
    
    <div class="form-section">
      <h3>üü£ Awin Transactions</h3>
      <div class="form-row">
        <div class="form-group">
          <label>OAuth2 Bearer Token</label>
          <input type="password" id="awin-token" placeholder="Your Awin API Token">
        </div>
        <div class="form-group">
          <label>Publisher ID</label>
          <input type="text" id="awin-publisher-id" placeholder="Your Publisher ID">
        </div>
      </div>
    </div>
    
    <div class="form-section">
      <h3>üìß Email Notifications (opcjonalne)</h3>
      <p style="color: #8b95a5; font-size: 13px; margin-bottom: 15px;">
        Zarejestruj siƒô na <a href="https://emailjs.com" target="_blank" style="color: #ffa726;">emailjs.com</a> aby otrzymywaƒá powiadomienia email
      </p>
      <div class="form-row">
        <div class="form-group">
          <label>EmailJS Service ID</label>
          <input type="text" id="emailjs-service" placeholder="service_xxxxxxx">
        </div>
        <div class="form-group">
          <label>EmailJS Template ID</label>
          <input type="text" id="emailjs-template" placeholder="template_xxxxxxx">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>EmailJS Public Key</label>
          <input type="text" id="emailjs-pubkey" placeholder="xxxxxxxxxxxxxx">
        </div>
        <div class="form-group">
          <label>Tw√≥j Email</label>
          <input type="email" id="notify-email" placeholder="twoj@email.com">
        </div>
      </div>
    </div>
    
    <button class="btn" id="connect-btn">‚Üí Po≈ÇƒÖcz Dashboard</button>
    <button class="btn btn-secondary" id="load-saved-btn" style="display:none;">üìã Za≈Çaduj ZapisanƒÖ Konfiguracjƒô</button>
  </div>
  
  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <div class="controls">
      <button class="refresh-btn" id="refresh-btn">üîÑ Od≈õwie≈º</button>
      
      <div class="auto-refresh">
        <label style="margin: 0; color: #8b95a5;">Auto-refresh:</label>
        <select id="auto-refresh">
          <option value="0">Wy≈ÇƒÖczony</option>
          <option value="60000">1 minuta</option>
          <option value="300000">5 minut</option>
          <option value="900000" selected>15 minut</option>
          <option value="1800000">30 minut</option>
        </select>
      </div>
      
      <button class="btn-secondary" id="enable-notifications" style="padding: 10px 20px; border-radius: 6px; cursor: pointer; display: none;">
        üîî W≈ÇƒÖcz Powiadomienia Push
      </button>
      
      <div class="last-update" id="last-update">Nie zaktualizowano</div>
    </div>
    
    <div class="error" id="dash-error"></div>
    <div class="success" id="dash-success"></div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="partnerize">Partnerize</button>
      <button class="tab" data-tab="zeropark">Zeropark</button>
      <button class="tab" data-tab="awin">Awin</button>
      <button class="tab" data-tab="notifications">Powiadomienia</button>
    </div>
    
    <!-- Partnerize Tab -->
    <div class="tab-content active" id="tab-partnerize">
      <div class="status-grid" id="pz-grid">
        <div class="loading">≈Åadowanie danych...</div>
      </div>
    </div>
    
    <!-- Zeropark Tab -->
    <div class="tab-content" id="tab-zeropark">
      <div class="simple-table" id="zp-table">
        <h3>üìä Statystyki Zeropark</h3>
        <div class="loading">≈Åadowanie danych...</div>
      </div>
    </div>
    
    <!-- Awin Tab -->
    <div class="tab-content" id="tab-awin">
      <div class="simple-table" id="awin-table">
        <h3>üìä Transakcje Awin</h3>
        <div class="loading">≈Åadowanie danych...</div>
      </div>
    </div>
    
    <!-- Notifications Tab -->
    <div class="tab-content" id="tab-notifications">
      <div class="notif-log" id="notif-log">
        <h3>üìù Log Powiadomie≈Ñ</h3>
        <div class="notif-empty">Brak zmian do wy≈õwietlenia</div>
      </div>
    </div>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG & STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PROXY = 'https://corsproxy.io/?';
const PZ_BASE_URLS = [
  'https://api.performancehorizon.com',
  'https://api.partnerize.com'
];
const ZP_BASE = 'https://panel.zeropark.com/api';
const AWIN_BASE = 'https://api.awin.com';

let config = {};
let prevData = {
  pz: null,
  zp: null,
  awin: null
};
let notifLog = [];
let autoRefreshTimer = null;
let pushReady = false;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  loadNotifLog();
  checkSavedConfig();
  initTabs();
  initEventListeners();
  checkNotificationPermission();
});

function checkSavedConfig() {
  const saved = localStorage.getItem('affiliate_config');
  if (saved) {
    document.getElementById('load-saved-btn').style.display = 'block';
  }
}

function loadSavedConfig() {
  const saved = localStorage.getItem('affiliate_config');
  if (!saved) return;
  
  const cfg = JSON.parse(saved);
  if (cfg.pzAppKey) document.getElementById('pz-app-key').value = cfg.pzAppKey;
  if (cfg.pzApiKey) document.getElementById('pz-api-key').value = cfg.pzApiKey;
  if (cfg.pzPublisherId) document.getElementById('pz-publisher-id').value = cfg.pzPublisherId;
  if (cfg.zpToken) document.getElementById('zp-token').value = cfg.zpToken;
  if (cfg.awinToken) document.getElementById('awin-token').value = cfg.awinToken;
  if (cfg.awinPublisherId) document.getElementById('awin-publisher-id').value = cfg.awinPublisherId;
  if (cfg.emailjsService) document.getElementById('emailjs-service').value = cfg.emailjsService;
  if (cfg.emailjsTemplate) document.getElementById('emailjs-template').value = cfg.emailjsTemplate;
  if (cfg.emailjsPubkey) document.getElementById('emailjs-pubkey').value = cfg.emailjsPubkey;
  if (cfg.notifyEmail) document.getElementById('notify-email').value = cfg.notifyEmail;
  
  showToast('Za≈Çadowano zapisanƒÖ konfiguracjƒô');
}

function initTabs() {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.dataset.tab;
      
      // Update tabs
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Update content
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).classList.add('active');
    });
  });
}

function initEventListeners() {
  document.getElementById('connect-btn').addEventListener('click', connect);
  document.getElementById('load-saved-btn').addEventListener('click', loadSavedConfig);
  document.getElementById('refresh-btn').addEventListener('click', () => refreshAll(true));
  document.getElementById('auto-refresh').addEventListener('change', setupAutoRefresh);
  document.getElementById('enable-notifications').addEventListener('click', requestNotificationPermission);
  
  // Enter key in inputs
  document.querySelectorAll('#setup input').forEach(input => {
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') connect();
    });
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONNECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function connect() {
  showError('setup-error', '');
  
  const pzAppKey = document.getElementById('pz-app-key').value.trim();
  const pzApiKey = document.getElementById('pz-api-key').value.trim();
  const pzPublisherId = document.getElementById('pz-publisher-id').value.trim();
  const zpToken = document.getElementById('zp-token').value.trim();
  const awinToken = document.getElementById('awin-token').value.trim();
  const awinPublisherId = document.getElementById('awin-publisher-id').value.trim();
  const emailjsService = document.getElementById('emailjs-service').value.trim();
  const emailjsTemplate = document.getElementById('emailjs-template').value.trim();
  const emailjsPubkey = document.getElementById('emailjs-pubkey').value.trim();
  const notifyEmail = document.getElementById('notify-email').value.trim();
  
  if (!pzApiKey && !zpToken && !awinToken) {
    showError('setup-error', 'Wype≈Çnij co najmniej jeden klucz API');
    return;
  }
  
  config = {
    pzAppKey, pzApiKey, pzPublisherId,
    zpToken,
    awinToken, awinPublisherId,
    emailjsService, emailjsTemplate, emailjsPubkey, notifyEmail
  };
  
  // Save config
  localStorage.setItem('affiliate_config', JSON.stringify(config));
  
  // Initialize EmailJS
  if (emailjsService && emailjsPubkey) {
    emailjs.init(emailjsPubkey);
  }
  
  // Load previous state
  loadPrevState();
  
  setLoading(true);
  
  try {
    await refreshAll(false);
    
    // Show dashboard
    document.getElementById('setup').style.display = 'none';
    document.getElementById('dashboard').classList.add('active');
    setConnStatus(true);
    
    // Setup auto-refresh
    setupAutoRefresh();
    
    showToast('Dashboard po≈ÇƒÖczony pomy≈õlnie!');
    
  } catch(e) {
    console.error('Connection error:', e);
    showError('setup-error', 'B≈ÇƒÖd po≈ÇƒÖczenia: ' + e.message);
  } finally {
    setLoading(false);
  }
}

function loadPrevState() {
  const pzPrev = localStorage.getItem('pz_prev');
  const zpPrev = localStorage.getItem('zp_prev');
  const awinPrev = localStorage.getItem('awin_prev');
  
  if (pzPrev) prevData.pz = JSON.parse(pzPrev);
  if (zpPrev) prevData.zp = JSON.parse(zpPrev);
  if (awinPrev) prevData.awin = JSON.parse(awinPrev);
}

async function refreshAll(manual = false) {
  showError('dash-error', '');
  
  const promises = [];
  
  if (config.pzApiKey) promises.push(refreshPartnerize(manual));
  if (config.zpToken) promises.push(refreshZeropark(manual));
  if (config.awinToken) promises.push(refreshAwin(manual));
  
  try {
    await Promise.all(promises);
    updateTimestamp();
    if (manual) showToast('Dane od≈õwie≈ºone pomy≈õlnie!');
  } catch(e) {
    console.error('Refresh error:', e);
    showError('dash-error', 'B≈ÇƒÖd od≈õwie≈ºania: ' + e.message);
    if (manual) showToast('B≈ÇƒÖd od≈õwie≈ºania danych');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PARTNERIZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function refreshPartnerize(manual) {
  try {
    const data = await fetchPartnerizePaymentSummary();
    const cards = processPartnerizePaymentSummary(data);
    
    // Detect changes
    if (prevData.pz && !manual) {
      const changes = detectPartnerizeChanges(prevData.pz, cards);
      if (changes.length > 0) {
        notifyChanges('Partnerize', changes);
      }
    }
    
    // Save current state
    prevData.pz = cards.map(c => ({
      status: c.status,
      currency: c.currency,
      amount: c.amount
    }));
    localStorage.setItem('pz_prev', JSON.stringify(prevData.pz));
    
    renderPartnerizeDashboard(cards);
    
  } catch(e) {
    console.error('Partnerize error:', e);
    throw e;
  }
}

async function fetchPartnerizePaymentSummary() {
  const endpoint = `/user/publisher/${config.pzPublisherId}/payment/summary`;
  
  // Try both base URLs
  for (const baseUrl of PZ_BASE_URLS) {
    const fullUrl = baseUrl + endpoint;
    
    const authString = config.pzAppKey + ':' + config.pzApiKey;
    const headers = {
      'Authorization': 'Basic ' + btoa(authString),
      'Accept': 'application/json'
    };
    
    const url = PROXY + encodeURIComponent(fullUrl);
    
    try {
      const res = await fetch(url, { headers });
      
      if (!res.ok) {
        if (baseUrl === PZ_BASE_URLS[PZ_BASE_URLS.length - 1]) {
          const txt = await res.text();
          throw new Error(`HTTP ${res.status}`);
        }
        continue;
      }
      
      return await res.json();
      
    } catch(e) {
      if (baseUrl === PZ_BASE_URLS[PZ_BASE_URLS.length - 1]) {
        throw e;
      }
    }
  }
}

function processPartnerizePaymentSummary(data) {
  // Handle nested structure: data.payments.summary
  let payment = null;
  
  if (data.payments?.summary) {
    payment = data.payments.summary;
  } else if (data.payment?.summary) {
    payment = data.payment.summary;
  } else if (data.summary) {
    payment = data.summary;
  } else {
    payment = data;
  }
  
  const cards = [];
  
  for (const [status, statusData] of Object.entries(payment)) {
    if (status === 'discrepancy' || status === 'execution_time') continue;
    if (!statusData || typeof statusData !== 'object') continue;
    if (Array.isArray(statusData)) continue;
    
    for (const [currency, value] of Object.entries(statusData)) {
      if (/^[A-Z]{3}$/.test(currency)) {
        const amount = parseFloat(value);
        if (!isNaN(amount) && amount > 0) {
          cards.push({ status, currency, amount });
        }
      }
    }
  }
  
  // Add empty statuses
  const allStatuses = ['pending', 'approved', 'confirmed', 'available', 'paid'];
  const existingStatuses = new Set(cards.map(c => c.status));
  
  for (const status of allStatuses) {
    if (!existingStatuses.has(status)) {
      cards.push({ status, currency: 'GBP', amount: 0 });
    }
  }
  
  // Sort by status order
  const statusOrder = { pending: 0, approved: 1, confirmed: 2, available: 3, paid: 4 };
  cards.sort((a, b) => (statusOrder[a.status] || 99) - (statusOrder[b.status] || 99));
  
  return cards;
}

function detectPartnerizeChanges(prev, current) {
  const changes = [];
  const prevMap = Object.fromEntries(prev.map(p => [`${p.status}_${p.currency}`, p.amount]));
  
  for (const card of current) {
    const key = `${card.status}_${card.currency}`;
    const prevAmount = prevMap[key] || 0;
    
    if (Math.abs(prevAmount - card.amount) > 0.01) {
      const diff = card.amount - prevAmount;
      changes.push({
        status: card.status,
        currency: card.currency,
        old: prevAmount,
        new: card.amount,
        diff: diff
      });
    }
  }
  
  return changes;
}

const PZ_STATUS_LABELS = {
  pending: 'OczekujƒÖce',
  approved: 'Zatwierdzone',
  confirmed: 'Potwierdzone',
  available: 'Dostƒôpne',
  paid: 'Wyp≈Çacone'
};

function renderPartnerizeDashboard(cards) {
  const grid = document.getElementById('pz-grid');
  
  const html = cards.map(card => {
    const opacity = card.amount === 0 ? 'opacity: 0.5;' : '';
    const emptyBadge = card.amount === 0 ? '<small style="color: #8b95a5;">Brak</small>' : '';
    
    return `
    <div class="status-card ${card.status}" style="${opacity}">
      <div class="status-label">${PZ_STATUS_LABELS[card.status] || card.status} ${emptyBadge}</div>
      <div class="status-value">${formatMoney(card.amount, card.currency)}</div>
      <div class="status-currency">${card.currency}</div>
    </div>
  `;
  }).join('');
  
  grid.innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ZEROPARK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function refreshZeropark(manual) {
  try {
    const yesterday = await fetchZeroparkStats('YESTERDAY');
    const thisMonth = await fetchZeroparkStats('THIS_MONTH');
    
    const data = { yesterday, thisMonth };
    
    // Detect changes
    if (prevData.zp && !manual) {
      const changes = detectZeroparkChanges(prevData.zp, data);
      if (changes.length > 0) {
        notifyChanges('Zeropark', changes);
      }
    }
    
    prevData.zp = data;
    localStorage.setItem('zp_prev', JSON.stringify(prevData.zp));
    
    renderZeroparkTable(data);
    
  } catch(e) {
    console.error('Zeropark error:', e);
    throw e;
  }
}

async function fetchZeroparkStats(interval) {
  const endpoint = `/stats/campaign/all?interval=${interval}`;
  const fullUrl = ZP_BASE + endpoint;
  
  const headers = {
    'api-token': config.zpToken,
    'Accept': 'application/json'
  };
  
  const url = PROXY + encodeURIComponent(fullUrl);
  const res = await fetch(url, { headers });
  
  if (!res.ok) {
    throw new Error(`HTTP ${res.status}`);
  }
  
  const data = await res.json();
  return data.summary || {};
}

function detectZeroparkChanges(prev, current) {
  const changes = [];
  
  if (prev.yesterday && current.yesterday) {
    if (Math.abs((prev.yesterday.profit || 0) - (current.yesterday.profit || 0)) > 0.01) {
      changes.push({
        period: 'Wczoraj',
        metric: 'Profit',
        old: prev.yesterday.profit || 0,
        new: current.yesterday.profit || 0
      });
    }
  }
  
  return changes;
}

function renderZeroparkTable(data) {
  const table = document.getElementById('zp-table');
  
  const html = `
    <h3>üìä Statystyki Zeropark</h3>
    <div class="table-row">
      <div>Okres</div>
      <div>Wydatki</div>
      <div>Zysk</div>
    </div>
    <div class="table-row">
      <div>Wczoraj</div>
      <div>$${(data.yesterday?.spent || 0).toFixed(2)}</div>
      <div style="color: ${(data.yesterday?.profit || 0) > 0 ? '#00e676' : '#ff4444'}">
        $${(data.yesterday?.profit || 0).toFixed(2)}
      </div>
    </div>
    <div class="table-row">
      <div>Ten miesiƒÖc</div>
      <div>$${(data.thisMonth?.spent || 0).toFixed(2)}</div>
      <div style="color: ${(data.thisMonth?.profit || 0) > 0 ? '#00e676' : '#ff4444'}">
        $${(data.thisMonth?.profit || 0).toFixed(2)}
      </div>
    </div>
  `;
  
  table.innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AWIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function refreshAwin(manual) {
  try {
    const yesterday = await fetchAwinTransactions('yesterday');
    const thisMonth = await fetchAwinTransactions('thisMonth');
    
    const data = { yesterday, thisMonth };
    
    // Detect changes
    if (prevData.awin && !manual) {
      const changes = detectAwinChanges(prevData.awin, data);
      if (changes.length > 0) {
        notifyChanges('Awin', changes);
      }
    }
    
    prevData.awin = data;
    localStorage.setItem('awin_prev', JSON.stringify(prevData.awin));
    
    renderAwinTable(data);
    
  } catch(e) {
    console.error('Awin error:', e);
    throw e;
  }
}

async function fetchAwinTransactions(period) {
  const now = new Date();
  let startDate, endDate;
  
  if (period === 'yesterday') {
    startDate = new Date(now);
    startDate.setDate(startDate.getDate() - 1);
    startDate.setHours(0, 0, 0, 0);
    endDate = new Date(startDate);
    endDate.setHours(23, 59, 59, 999);
  } else {
    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
    endDate = new Date(now);
  }
  
  const startStr = startDate.toISOString().split('T')[0];
  const endStr = endDate.toISOString().split('T')[0];
  
  const endpoint = `/publishers/${config.awinPublisherId}/transactions/?startDate=${startStr}&endDate=${endStr}`;
  const fullUrl = AWIN_BASE + endpoint;
  
  const headers = {
    'Authorization': `Bearer ${config.awinToken}`,
    'Accept': 'application/json'
  };
  
  const url = PROXY + encodeURIComponent(fullUrl);
  const res = await fetch(url, { headers });
  
  if (!res.ok) {
    throw new Error(`HTTP ${res.status}`);
  }
  
  const data = await res.json();
  const transactions = data || [];
  
  // Aggregate
  let totalCommission = 0;
  let pending = 0;
  let approved = 0;
  
  for (const t of transactions) {
    const commission = parseFloat(t.commissionAmount?.amount || 0);
    totalCommission += commission;
    
    const status = (t.validationStatus || '').toLowerCase();
    if (status === 'pending') pending += commission;
    else if (status === 'approved') approved += commission;
  }
  
  return { total: totalCommission, pending, approved, count: transactions.length };
}

function detectAwinChanges(prev, current) {
  const changes = [];
  
  if (prev.yesterday && current.yesterday) {
    if (Math.abs((prev.yesterday.total || 0) - (current.yesterday.total || 0)) > 0.01) {
      changes.push({
        period: 'Wczoraj',
        metric: 'Total',
        old: prev.yesterday.total || 0,
        new: current.yesterday.total || 0
      });
    }
  }
  
  return changes;
}

function renderAwinTable(data) {
  const table = document.getElementById('awin-table');
  
  const html = `
    <h3>üìä Transakcje Awin</h3>
    <div class="table-row">
      <div>Okres</div>
      <div>Prowizje</div>
      <div>Status</div>
    </div>
    <div class="table-row">
      <div>Wczoraj</div>
      <div>¬£${(data.yesterday?.total || 0).toFixed(2)}</div>
      <div style="font-size: 12px; color: #8b95a5;">
        Pending: ¬£${(data.yesterday?.pending || 0).toFixed(2)}<br>
        Approved: ¬£${(data.yesterday?.approved || 0).toFixed(2)}
      </div>
    </div>
    <div class="table-row">
      <div>Ten miesiƒÖc</div>
      <div>¬£${(data.thisMonth?.total || 0).toFixed(2)}</div>
      <div style="font-size: 12px; color: #8b95a5;">
        Pending: ¬£${(data.thisMonth?.pending || 0).toFixed(2)}<br>
        Approved: ¬£${(data.thisMonth?.approved || 0).toFixed(2)}
      </div>
    </div>
  `;
  
  table.innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkNotificationPermission() {
  if (!('Notification' in window)) return;
  
  if (Notification.permission === 'granted') {
    pushReady = true;
  } else if (Notification.permission !== 'denied') {
    document.getElementById('enable-notifications').style.display = 'block';
  }
}

async function requestNotificationPermission() {
  if (!('Notification' in window)) {
    showToast('Twoja przeglƒÖdarka nie obs≈Çuguje powiadomie≈Ñ');
    return;
  }
  
  const permission = await Notification.requestPermission();
  if (permission === 'granted') {
    pushReady = true;
    document.getElementById('enable-notifications').style.display = 'none';
    showToast('Powiadomienia w≈ÇƒÖczone!');
  }
}

function notifyChanges(platform, changes) {
  const timestamp = new Date().toLocaleString('pl-PL');
  
  // Add to log
  for (const change of changes) {
    let message = `${platform}: `;
    
    if (change.status) {
      // Partnerize
      message += `${PZ_STATUS_LABELS[change.status] || change.status} ${change.currency}: `;
      message += `${formatMoney(change.old, change.currency)} ‚Üí ${formatMoney(change.new, change.currency)}`;
      message += ` (${change.diff > 0 ? '+' : ''}${formatMoney(change.diff, change.currency)})`;
    } else if (change.period) {
      // Zeropark/Awin
      message += `${change.period} - ${change.metric}: `;
      message += `$${change.old.toFixed(2)} ‚Üí $${change.new.toFixed(2)}`;
    }
    
    notifLog.unshift({ time: timestamp, message });
  }
  
  // Keep last 100
  notifLog = notifLog.slice(0, 100);
  saveNotifLog();
  renderNotifLog();
  
  // Push notification
  if (pushReady && Notification.permission === 'granted') {
    const title = `${platform} - Zmiany wykryte`;
    const body = changes.slice(0, 3).map(c => {
      if (c.status) {
        return `${PZ_STATUS_LABELS[c.status]}: ${formatMoney(c.old, c.currency)} ‚Üí ${formatMoney(c.new, c.currency)}`;
      } else {
        return `${c.period}: $${c.old.toFixed(2)} ‚Üí $${c.new.toFixed(2)}`;
      }
    }).join('\n');
    
    new Notification(title, { body, icon: '/favicon.ico' });
  }
  
  // Email notification
  if (config.emailjsService && config.notifyEmail && config.emailjsTemplate) {
    sendEmail(platform, changes);
  }
  
  // Toast
  showToast(`${platform}: Wykryto ${changes.length} zmian`);
}

async function sendEmail(platform, changes) {
  if (!config.emailjsService || !config.emailjsTemplate) return;
  
  const changesHtml = changes.map(c => {
    if (c.status) {
      return `<li>${PZ_STATUS_LABELS[c.status]} ${c.currency}: ${formatMoney(c.old, c.currency)} ‚Üí ${formatMoney(c.new, c.currency)} (${c.diff > 0 ? '+' : ''}${formatMoney(c.diff, c.currency)})</li>`;
    } else {
      return `<li>${c.period} - ${c.metric}: $${c.old.toFixed(2)} ‚Üí $${c.new.toFixed(2)}</li>`;
    }
  }).join('');
  
  const params = {
    to_email: config.notifyEmail,
    platform: platform,
    changes_html: `<ul>${changesHtml}</ul>`,
    timestamp: new Date().toLocaleString('pl-PL')
  };
  
  try {
    await emailjs.send(config.emailjsService, config.emailjsTemplate, params);
    console.log('Email sent successfully');
  } catch(e) {
    console.error('Email send error:', e);
  }
}

function loadNotifLog() {
  const saved = localStorage.getItem('notif_log');
  if (saved) {
    notifLog = JSON.parse(saved);
  }
}

function saveNotifLog() {
  localStorage.setItem('notif_log', JSON.stringify(notifLog));
}

function renderNotifLog() {
  const log = document.getElementById('notif-log');
  
  if (!notifLog.length) {
    log.innerHTML = '<h3>üìù Log Powiadomie≈Ñ</h3><div class="notif-empty">Brak zmian do wy≈õwietlenia</div>';
    return;
  }
  
  const html = notifLog.slice(0, 50).map(entry => `
    <div class="notif-entry">
      <span class="notif-time">${entry.time}</span>
      <span class="notif-msg">${entry.message}</span>
    </div>
  `).join('');
  
  log.innerHTML = `<h3>üìù Log Powiadomie≈Ñ</h3>${html}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTO-REFRESH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupAutoRefresh() {
  if (autoRefreshTimer) {
    clearInterval(autoRefreshTimer);
    autoRefreshTimer = null;
  }
  
  const interval = parseInt(document.getElementById('auto-refresh').value);
  if (interval > 0) {
    autoRefreshTimer = setInterval(() => refreshAll(false), interval);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function formatMoney(amount, currency) {
  return new Intl.NumberFormat('pl-PL', {
    style: 'currency',
    currency: currency || 'GBP'
  }).format(amount);
}

function showError(id, message) {
  const el = document.getElementById(id);
  if (message) {
    el.textContent = message;
    el.classList.add('active');
  } else {
    el.classList.remove('active');
  }
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

function setLoading(loading) {
  const btn = document.getElementById('connect-btn');
  if (loading) {
    btn.disabled = true;
    btn.textContent = '≈ÅƒÖczenie...';
  } else {
    btn.disabled = false;
    btn.textContent = '‚Üí Po≈ÇƒÖcz Dashboard';
  }
}

function setConnStatus(connected) {
  const status = document.getElementById('conn-status');
  const text = document.getElementById('conn-text');
  
  if (connected) {
    status.classList.remove('disconnected');
    status.classList.add('connected');
    text.textContent = 'Po≈ÇƒÖczony';
  } else {
    status.classList.remove('connected');
    status.classList.add('disconnected');
    text.textContent = 'Roz≈ÇƒÖczony';
  }
}

function updateTimestamp() {
  const now = new Date();
  const time = now.toLocaleTimeString('pl-PL');
  document.getElementById('last-update').textContent = `Ostatnia aktualizacja: ${time}`;
}

console.log('Affiliate Dashboard loaded successfully');
</script>
</body>
</html>
